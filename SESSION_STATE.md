# SESSION_STATE

## 当前阶段
全栈可运行 + 文档体系重构完成 + 真实源联调待完成。

## 已确认事项
1. 覆盖范围：全国；预警区域按省份展示。
2. 时间范围：未来 7 天。
3. 刷新频率：30 分钟。
4. 内容范围：预警信息 + 预报曲线。
5. 终端要求：Web UI，支持 Docker 部署。
6. 当前定位：当前省份优先并高亮，其他按首字母排序。
7. 曲线定位：以当前定位点为准。
8. AI 使用：允许用于公告信息分析与筛选（辅助解读）。

## 当前能力概览
1. 全栈服务可运行：`web + api + worker + db + redis`。
2. 地图支持省级风险着色、缩放控制、一键还原、地图自选位置开关。
3. 定位支持浏览器定位、手动经纬度输入、地图点选回填。
4. 地图图钉与输入经纬度保持联动，省份点击可触发联动刷新。
5. 当前省份仅边界高亮，固定边界图例常驻显示。
6. 南海诸岛使用独立 inset 小框展示，边界可读性提升。
7. mock 演示数据覆盖多省份/多类型/多等级预警场景。
8. 推荐开发流程：后端容器常驻 + 前端 Vite 热更新，避免频繁镜像重建。
9. 一键脚本：`dev.sh` 启动，`dev-stop.sh` 彻底停止。

## 本次会话产出（累计）
1. 建立文档基线：`PROJECT.md`、`ARCHITECTURE.md`、`RULES.md`、`SESSION_STATE.md`、`DECISIONS.md`。
2. 搭建 backend（FastAPI + SQLAlchemy）基础框架与 API。
3. 搭建 frontend（React + TypeScript + ECharts）基础看板页面。
4. 搭建 worker（APScheduler）30 分钟刷新任务骨架。
5. 增加 Docker Compose 编排（web/api/worker/db/redis）。
6. 增加 `.env.example`、`README.md`、`.gitignore`。
7. 前端完成全国省级地图可视化与定位交互增强。
8. 后端完成多数据源 provider 框架与 AI 配置化骨架。
9. mock 预警扩展为标准化演示场景（`MockScenario`）。
10. 修复地图重影（单底图渲染）并稳定图钉显示。
11. 恢复 worker 启动并完成全栈运行验证。
12. 完成省份联动增强：地图点击、列表点击与位置状态统一同步。
13. 完成当前省份边界高亮修正：禁用遮罩填充，避免覆盖风险色。
14. 新增固定边界图例与南海诸岛 inset 小框，并完成部署验证。
15. 完成 `README.md` 全量重写，补齐本地与单机生产完整部署攻略。
16. 同步更新 `PROJECT/ARCHITECTURE/RULES/DECISIONS`，统一部署与运维口径。
17. 增加一键开发/停止脚本（`dev.sh`、`dev-stop.sh`）。

## 当前未做 / 风险
1. 真实地址反查未接入（当前仅展示经纬度）。
2. 真实数据源字段稳定性与抗波动能力仍需联调验证。
3. 生产环境监控、告警与降级策略尚未完全落地。
4. Docker Hub 偶发网络波动（EOF）会影响镜像重建稳定性。
5. 地图复杂邻接边界在极端缩放下仍可能出现观感不均，需持续调优。

## 下一步（仅 3 条）
1. 真实数据源联调：NMC / QWeather / Open-Meteo 字段映射与稳定性校验。
2. AI 抽取质量与阈值校准：完成样本评估并固化展示策略。
3. 运行监控与错误告警落地：覆盖抓取失败、延迟、空数据占比。
