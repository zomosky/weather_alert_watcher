# PROJECT

## 项目目标
构建一个“全国极端天气展示看板”项目，优先使用国内官方气象来源（如 CMA/NMC 公告与预警信息），在统一 Web UI 中提供：

1. 未来 7 天气象风险与预警信息展示。
2. 基于用户当前位置的省份优先视图与高亮。
3. 支持定位授权、地图点选、地址输入、经纬度输入等定位方式。
4. 温度、湿度等曲线展示（以当前定位点为准）。
5. 可容器化部署（Docker），便于后续维护与扩展。

## 项目类型
- 类型：数据聚合 + 可视化看板（Web）
- 当前阶段：全栈可运行 + 文档体系重构完成 + 真实源联调待完成
- 优先级：稳定性、可维护性、可扩展性优先于功能堆叠

## 运行方式
当前仓库已具备可运行服务（Web/API/Worker/DB/Redis），并支持配置化数据源切换。运行方式原则如下：

1. 本地开发：基于容器编排统一启动依赖与服务。
2. 生产部署：优先使用 Docker/Docker Compose。
3. 数据刷新：定时任务按 30 分钟周期拉取并更新。
4. 故障策略：数据源异常时可降级展示，并显式标注延迟状态。

## 部署可交付目标（本轮）
1. 新成员仅阅读 `README.md` 可完成本地启动与基础验收。
2. 单机生产部署路径可执行：`Docker Compose + Nginx + Let's Encrypt`。
3. 运维常用动作可查：重建、升级、回滚、备份、故障排查。

## 当前范围（V1）
- 全国覆盖，按省份组织预警信息。
- 当前定位省份优先展示并高亮。
- 未来 7 天时间窗。
- 预警信息 + 预报曲线双轨展示。
- 支持 Web 端可视化与容器化部署。

## 当前已具备能力
1. 用户定位与手动定位：支持浏览器定位、经纬度输入、地图点选回填。
2. 地图图钉联动：地图图钉与输入经纬度保持一致。
3. 地图交互增强：支持缩放限制、一键还原视图、地图自选位置开关。
4. 省份联动增强：地图点省份可实时联动列表排序、省份高亮与曲线刷新。
5. 地图视觉增强：当前省份仅边界高亮（不覆盖风险填充），并提供固定边界图例。
6. 离线地图增强：南海诸岛以独立 inset 小框显示，避免与主图边界重叠。
7. 演示预警增强：内置多省份、多类型、多等级 mock 预警场景。
8. 全栈可运行：`web + api + worker + db + redis` 可同时运行。

## 当前限制
1. 地址反查未接入：当前仅展示经纬度，不做逆地理编码。
2. 真实数据源仍需联调：NMC/QWeather/Open-Meteo 在不同网络环境下仍需字段稳定性验证。
3. 生产配置需收紧：生产建议关闭 `FALLBACK_TO_MOCK_ON_FAILURE`，避免模拟数据混入。
4. 地图高亮边界依赖前端渲染层：复杂邻接边界在极端缩放下仍需持续调优线条观感。

## 生产边界（本轮）
1. 仅覆盖单机 Linux 部署（Ubuntu 22.04 推荐）。
2. 不覆盖 Kubernetes、多机编排、云厂商托管服务。
3. 生产入口默认采用 Nginx 反代与 Let's Encrypt 证书。

## 暂不纳入（V1 之外）
- 账号体系
- 消息推送（短信/邮件/IM）
- 历史回溯与统计报表
- 复杂权限与审计体系

## 可优化方向（后续迭代）
1. 多源交叉校验：提高预警准确性与稳定性。
2. 历史事件归档：支持回放与趋势分析。
3. 订阅与通知：按省份/风险类型进行主动提醒。
4. 省市县多级下钻：从省级扩展到市县级别。
5. AI 解读策略优化：提高公告口语化文本抽取质量与可解释性。
6. 前端包体优化：地图与图表按路由/模块拆分，降低首屏包体积。

## 待确认事项（精简）
1. 真实预警主通道优先级：`NMC 公告抓取` 还是 `QWeather API`。
2. AI 阈值策略：低置信度结果仅标注辅助解读，还是默认不展示。
3. 生产降级策略：`FALLBACK_TO_MOCK_ON_FAILURE` 是否在生产完全关闭。
