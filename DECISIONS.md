# DECISIONS

## 2026-02-12

### D-001: V1 单体分层架构（非微服务）
- 决策：采用单体仓库 + 分层模块（采集/处理/API/UI）而非微服务拆分。
- 原因：当前阶段以快速交付、可维护和低运维复杂度为主。
- 影响：后续扩展时可按采集与推理链路逐步拆分，但当前保持最小系统复杂度。

### D-002: 前后端技术栈固定
- 决策：前端采用 React + TypeScript + ECharts；后端采用 FastAPI + SQLAlchemy。
- 原因：社区成熟度高，长期维护成本可控，适合看板和数据 API 场景。
- 影响：后续 UI 主题和数据源变化不影响主干技术选型。

### D-003: 30 分钟调度由独立 worker 执行
- 决策：将数据刷新任务放在 worker（APScheduler）中，API 服务不承载周期任务。
- 原因：职责分离，减少 API 启动负担，便于后续迁移到队列系统。
- 影响：部署需包含 worker 进程；Compose 已纳入该组件。

### D-004: 前端地图使用本地 GeoJSON 资源离线注册
- 决策：前端地图组件将中国 GeoJSON 文件置于项目内并通过 `echarts.registerMap` 注册，不依赖运行时外网请求。
- 原因：满足离线部署要求，降低网络波动对可视化稳定性的影响。
- 影响：前端静态资源体积增加，但部署链路更稳定、可预测。

### D-005: 预警与预报采用独立 provider 配置
- 决策：将 `WARNING_PROVIDER` 与 `FORECAST_PROVIDER` 独立配置，而非单一数据源绑定。
- 原因：公告类预警和数值预报通常来自不同渠道，独立配置更符合实际数据供给形态。
- 影响：可灵活组合（如 NMC+OpenMeteo、QWeather+QWeather），便于灰度切换。

### D-006: AI 提取器作为可选增强链路
- 决策：AI 提取器通过 `AI_PROVIDER` 控制，默认关闭；仅对公告文本链路可选启用。
- 原因：降低默认运行成本和外部依赖，便于离线开发与安全管理。
- 影响：不配置 key 时系统仍可运行；开启后可提供公告结构化摘要与置信度。

### D-007: 采集失败默认可降级到 mock
- 决策：保留 `FALLBACK_TO_MOCK_ON_FAILURE` 开关，默认启用用于开发期连续可视化。
- 原因：避免外部数据源不可用时看板完全空白，提升开发和演示稳定性。
- 影响：生产环境建议关闭该开关，以避免混入模拟数据。

### D-008: 地图单底图渲染策略
- 决策：移除 `geo` 叠层，仅保留 `series.map` 作为地图底图。
- 原因：消除地图重影、边界重复渲染和视觉发虚问题。
- 影响：图层结构更清晰，地图性能与可读性提升。

### D-009: 地图点选交互策略
- 决策：点选地图仅回填经纬度与省份，不自动刷新看板数据（该策略已被后续决策替代）。
- 原因：避免误请求与交互抖动，保留用户显式确认动作。
- 影响：用户需点击“更新看板”后才触发数据请求，但交互可控性更高。
- 备注：D-011 已正式替代该策略，当前行为以 D-011 为准。

### D-010: 演示预警场景标准化
- 决策：mock 预警扩展为多省份/多类型/多等级固定场景，统一标记 `MockScenario`。
- 原因：保障演示稳定、结果可复现，便于验证地图与列表联动。
- 影响：演示效果更完整；生产环境需确保禁用或隔离该场景。

### D-011: 省份联动刷新策略调整
- 决策：地图点击省份与预警列表点击可触发自动刷新；手工输入保留“更新看板”显式触发。
- 原因：强化多入口实时联动体验，减少“状态已切换但数据未刷新”的理解成本。
- 影响：交互响应更直接；请求频次较之前“全手动触发”略有增加。

### D-012: 当前省份高亮语义固定为“仅边界”
- 决策：当前省份不使用填充遮罩，仅使用高对比边界强调；风险填充语义仅由红橙黄蓝表示。
- 原因：避免选中态覆盖风险色，确保全国风险态势可读。
- 影响：地图高亮与风险含义清晰分离，视觉冲突降低。

### D-013: 固定边界图例与南海 inset 常驻
- 决策：新增固定“当前省份（仅边界高亮）”图例，且在地图底部常驻；南海诸岛改为独立 inset 小框。
- 原因：解决反选后边界语义消失、南海边界与主图叠层不清晰的问题。
- 影响：地图语义稳定性与可读性提升，演示效果更一致。

## 2026-02-13

### D-014: README 作为部署标准入口文档
- 决策：将 `README.md` 定位为部署与运维的真源文档，覆盖本地启动、单机上线、运维与排障。
- 原因：降低新成员接入成本，避免分散文档造成执行偏差。
- 影响：后续部署流程变更必须优先同步 README。

### D-015: 生产默认采用 Nginx + Let's Encrypt 单机方案
- 决策：生产部署默认路径固定为 `Docker Compose + Nginx + Let's Encrypt`。
- 原因：方案成熟、维护成本可控，满足当前单机上线需求。
- 影响：本轮不引入 Kubernetes 与多机编排，相关方案延后评估。

### D-016: 主图去南海、南海 inset 独立展示策略固化
- 决策：主图不展示南海诸岛要素，仅保留独立 inset 小框展示南海。
- 原因：避免主图与 inset 重复显示造成视觉冲突与语义混乱。
- 影响：地图可读性提升；后续地图资源替换需保持该约束。
